<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>开源应用商店 - 跨平台应用商店</title>
    <style>
      /* 性能优化和平滑过渡 */
      :root {
        --transition-duration: 150ms;
        
        /* 预定义所有主题颜色变量 - 减少首次切换卡顿 */
        --app-bg-color-light: #f5f5f7;
        --app-text-color-light: #1d1d1f;
        --app-overlay-color-light: rgba(245, 245, 247, var(--app-bg-opacity, 0.8));
        
        --app-bg-color-dark: #1d1d1f;
        --app-text-color-dark: #f5f5f7;
        --app-overlay-color-dark: rgba(29, 29, 31, var(--app-bg-opacity, 0.8));
        
        /* 默认应用亮色主题变量 */
        --app-bg-color: var(--app-bg-color-light);
        --app-text-color: var(--app-text-color-light);
        --app-overlay-color: var(--app-overlay-color-light);
        --app-bg-opacity: 0.8;
      }
      
      /* 为暗色主题预加载样式 */
      [data-preload-dark] {
        background-color: var(--app-bg-color-dark);
        color: var(--app-text-color-dark);
        position: absolute;
        opacity: 0;
        pointer-events: none;
        width: 0;
        height: 0;
        overflow: hidden;
      }
      
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      
      /* 应用平滑过渡 */
      body * {
        transition: background-color var(--transition-duration) ease-out,
                    color var(--transition-duration) ease-out,
                    border-color var(--transition-duration) ease-out;
      }
      
      /* 主题切换时的平滑过渡 */
      body.theme-changing * {
        transition: background-color var(--transition-duration) ease-out,
                    color var(--transition-duration) ease-out,
                    border-color var(--transition-duration) ease-out !important;
      }
      
      /* 背景切换时的平滑过渡 */
      body.bg-changing #root > div::before {
        transition: opacity 0.2s ease-out, background-color 0.2s ease-out !important;
      }
      
      /* 强制硬件加速关键元素 */
      #root > div, 
      #root > div::before,
      #root > div > div {
        transform: translateZ(0);
        backface-visibility: hidden;
        perspective: 1000px;
        will-change: transform, opacity;
      }
      
      /* 图片渲染优化 */
      img {
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
      }
      
      /* 防止FOUC (闪烁无样式内容) */
      #root {
        opacity: 0;
        transition: opacity 0.15s ease-out;
      }
      
      #root.loaded {
        opacity: 1;
      }
      
      /* 提前加载默认背景图片 */
      body::after {
        content: '';
        position: absolute;
        width: 0;
        height: 0;
        overflow: hidden;
        z-index: -1;
        background-image: 
          url('https://cdn.pixabay.com/photo/2020/10/27/08/00/mountains-5689938_1280.png'),
          url('https://cdn.pixabay.com/photo/2012/08/27/14/19/mountains-55067_1280.png'),
          url('https://media.istockphoto.com/id/1145054673/zh/%E5%90%91%E9%87%8F/%E6%B5%B7%E7%81%98.jpg');
      }
    </style>
    <script>
      // 获取用户当前主题偏好
      const savedTheme = localStorage.getItem('theme') || 'light';
      // 应用到HTML元素，这样CSS可以立即生效
      document.documentElement.setAttribute('data-theme', savedTheme);
      
      // 预加载主题
      document.addEventListener('DOMContentLoaded', function() {
        // 添加已加载样式，淡入显示
        setTimeout(() => {
          const root = document.getElementById('root');
          if (root) root.classList.add('loaded');
        }, 50);
      });
    </script>
  </head>

  <body>
    <div id="root"></div>
    <!-- 预加载暗色主题样式的隐藏元素 -->
    <div data-preload-dark></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
